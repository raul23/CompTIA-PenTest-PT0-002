====================================
Lab Exercises: Information gathering
====================================

.. contents:: **Contents**
   :depth: 5
   :local:
   :backlinks: top

Book: CompTIA Pentest+ Certification For Dummies (2nd ed., 2022)
================================================================
Exercise 3-1: Conduct a Whois Search with ARIN
----------------------------------------------
`:information_source:` using **www.arin.net/whois** to get information about an organization

1. Search for an organization
2. Click on the link for the Handle **"MICRO-218"**
3. At the bottom of the results, the entry **"Net Range"** gives the **public IPs** for the organization

   These are the public IP blocks that need to be documented in the pentest report.

Exercise 3-2: Use ``theHarvester`` to collect email addresses
-------------------------------------------------------------
`:information_source:` using ``theHarvester`` to collect email addresses and hosts IP addresses for an organization

On a terminal:

.. code-block::
   
   $ theharvester -d example.com -b all

The email and IP address need to be documented in the pentest report.

Exercise 3-3: Use Shodan to discover systems on the Internet
------------------------------------------------------------
`:information_source:` 
 
 - using **shodan.io** to discover systems and information about systems on the Internet for an organization
 - You need to register to use **shodan.io**
 - The "View on Map" tab is only available if you become a member 

1. Search for an organization
2. When clicking on an IP address, you can get lots of info about the organization such as:

   - Country, City, Organization, ISP, ASN
   - Vulnerabilities (list of CVEs), e.g.::
   
      CVE-2021-31806	An issue was discovered in Squid before 4.15 and 5.x before 5.0.6. Due to a 
                        memory-management bug, it is vulnerable to a Denial of Service attack (against 
                        all clients using the proxy) via HTTP Range request processing.
   - Certificates: name of server that issued them and their paths
   - Open Ports
   - The output from the server when connecting to an open port, e.g.::
  
      HTTP/1.1 400 Bad Request
      Server: squid/4.14
      Mime-Version: 1.0
      Date: Thu, 16 Feb 2023 19:07:45 GMT
      Content-Type: text/html;charset=utf-8
      Content-Length: 16
      X-Squid-Error: ERR_INVALID_URL 0

     `:information_source:` **Squid** is a caching and forwarding HTTP web proxy (from 
     `en.wikipedia.org/wiki/Squid_(software) <https://en.wikipedia.org/wiki/Squid_(software)>`_).

Exercise 3-4: Use ``recon-ng`` for OSINT information gathering
--------------------------------------------------------------
`:information_source:` using ``recon-ng`` to perform OSINT information gathering

1. Start ``recon-ng`` and create a workspace:
 
   .. code-block::
   
      $ recon-ng
      
      [recon-ng][default] > workspaces create acme
      [recon-ng][acme] > 
  
2. Configure the domains and the company names:

   .. code-block::
   
      [recon-ng][acme] > db insert domains
      domain (TEXT): acme.com
      notes (TEXT): 
      
      [recon-ng][acme] > db insert companies
      company (TEXT): Acme~A publishing company
      description (TEXT):
      notes (TEXT): 

3. To view the domains and company tables:

   .. code-block::
   
        [recon-ng][acme] > show domains

        +----------------------------------------------+
        | rowid |     domain    | notes |    module    |
        +----------------------------------------------+
        | 1     | acme.com      |       | user_defined |
        +----------------------------------------------+
        
        [recon-ng][acme] > show companies

        +-------------------------------------------------------------------------+
        | rowid |          company           | description | notes |    module    |
        +-------------------------------------------------------------------------+
        | 1     | Acme~A publishing company  |             |       | user_defined |
        +-------------------------------------------------------------------------+

4. Install the WHOIS search module:

   .. code-block::
   
      [recon-ng][acme] > marketplace search whois
      [*] Searching module index for 'whois'...                                                                                            
                                                                                                                                     
        +----------------------------------------------------------------------------------------------+                                   
        |                      Path                     | Version |     Status    |  Updated   | D | K |                                   
        +----------------------------------------------------------------------------------------------+                                   
        | recon/companies-domains/viewdns_reverse_whois | 1.1     | not installed | 2021-08-24 |   |   |
        | recon/companies-multi/whois_miner             | 1.1     | not installed | 2019-10-15 |   |   |
        | recon/domains-companies/whoxy_whois           | 1.1     | not installed | 2020-06-24 |   | * |
        | recon/domains-contacts/whois_pocs             | 1.0     | not installed | 2019-06-24 |   |   |
        | recon/netblocks-companies/whois_orgs          | 1.0     | not installed | 2019-06-24 |   |   |
        +----------------------------------------------------------------------------------------------+

        D = Has dependencies. See info for details.
        K = Requires keys. See info for details.

      [recon-ng][acme] > marketplace install recon/domains-contacts/whois_pocs
      [*] Module installed: recon/domains-contacts/whois_pocs
      [*] Reloading modules...

5. Load the module:

   .. code-block::
   
      [recon-ng][acme] > modules load recon/domains-contacts/whois_pocs
      [recon-ng][acme][whois_pocs] >

6. To see information about this module:

   .. code-block::
   
      [recon-ng][acme][whois_pocs] > info

            Name: Whois POC Harvester
          Author: Tim Tomes (@lanmaster53)
         Version: 1.0

      Description:
        Uses the ARIN Whois RWS to harvest POC data from whois queries for the given domain. Updates the
        'contacts' table with the results.

      Options:
        Name    Current Value  Required  Description
        ------  -------------  --------  -----------
        SOURCE  default        yes       source of input (see 'info' for details)

      Source Options:
        default        SELECT DISTINCT domain FROM domains WHERE domain IS NOT NULL
        <string>       string representing a single input
        <path>         path to a file containing a list of inputs
        query <sql>    database query returning one column of inputs

7. Begin searching WHOIS for information regarding “acme.com”:

   .. code-block::
   
      [recon-ng][acme][whois_pocs] > run

      ---------
      ACME.COM
      ---------
      [*] URL: http://whois.arin.net/rest/pocs;domain=acme.com
      [*] URL: http://whois.arin.net/rest/poc/EMBLE-ARIN
      [*] Country: United States
      [*] Email: blabla@acme.com
      [*] First_Name: Bla
      [*] Last_Name: Blabla
      [*] Middle_Name: None
      [*] Notes: None
      [*] Phone: None
      [*] Region: Toronto, ON
      [*] Title: Whois contact
      [*] --------------------------------------------------

8. Retrieve a list of related domains and hosts from Bing and Google:

   .. code-block::

9. Generate an HTML report:

   .. code-block::
   
